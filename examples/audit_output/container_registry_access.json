{
  "Name": "container_registry_access",
  "PodsDestroyed": 2,
  "ScenariosAttempted": 3,
  "ScenariosSucceeded": 3,
  "ScenariosFailed": 0,
  "Result": "Success",
  "Scenarios": {
    "1": {
      "Name": "Ensure container image registries are read-only",
      "Result": "Passed",
      "Tags": [
        "@k-cra",
        "@probes/kubernetes/container_registry_access",
        "@k-cra-001"
      ],
      "Steps": {
        "1": {
          "Name": "aKubernetesClusterIsDeployed",
          "Description": "Validated that the k8s cluster specified in '/root/.kube/config' is deployed by checking the '' context; ",
          "Result": "Passed",
          "Error": "",
          "Payload": {
            "KubeConfigPath": "/root/.kube/config",
            "KubeContext": ""
          }
        },
        "2": {
          "Name": "iAmAuthorisedToPullFromAContainerRegistry",
          "Description": "Attempted to create a new pod using an image pulled from authorized registry; ",
          "Result": "Passed",
          "Error": "",
          "Payload": {
            "AuthorizedRegistry": "citihubprod.azurecr.io",
            "PodAudit": {
              "PodName": "ca-test-citihubprod-azurecr-io-220221-103710-96",
              "Namespace": "probr-general-test-ns",
              "ContainerName": "container-access-test",
              "Image": "citihubprod.azurecr.io/citihub/probr-probe",
              "SecurityContext": null
            }
          }
        },
        "3": {
          "Name": "iAttemptToPushToTheContainerRegistryUsingTheClusterIdentity",
          "Description": "PENDING IMPLEMENTATION",
          "Result": "Passed",
          "Error": "",
          "Payload": null
        }
      }
    },
    "2": {
      "Name": "Ensure deployment from an authorised container registry is allowed",
      "Result": "Passed",
      "Tags": [
        "@k-cra",
        "@probes/kubernetes/container_registry_access",
        "@k-cra-002"
      ],
      "Steps": {
        "1": {
          "Name": "aKubernetesClusterIsDeployed",
          "Description": "Validated that the k8s cluster specified in '/root/.kube/config' is deployed by checking the '' context; ",
          "Result": "Passed",
          "Error": "",
          "Payload": {
            "KubeConfigPath": "/root/.kube/config",
            "KubeContext": ""
          }
        },
        "2": {
          "Name": "iAmAuthorisedToPullFromAContainerRegistry",
          "Description": "Attempted to create a new pod using an image pulled from authorized registry; ",
          "Result": "Passed",
          "Error": "",
          "Payload": {
            "AuthorizedRegistry": "citihubprod.azurecr.io",
            "PodAudit": {
              "PodName": "ca-test-citihubprod-azurecr-io-220221-103713-86",
              "Namespace": "probr-general-test-ns",
              "ContainerName": "container-access-test",
              "Image": "citihubprod.azurecr.io/citihub/probr-probe",
              "SecurityContext": null
            }
          }
        },
        "3": {
          "Name": "theDeploymentAttemptIsAllowed",
          "Description": "Asserts pod creation result in scenario state is successful; ",
          "Result": "Passed",
          "Error": "",
          "Payload": {
            "PodState": {
              "PodName": "ca-test-citihubprod-azurecr-io-220221-103713-86",
              "CreationError": null,
              "ExpectedReason": null,
              "CommandExitCode": 0
            }
          }
        }
      }
    },
    "3": {
      "Name": "Ensure deployment from an unauthorised container registry is denied",
      "Result": "Passed",
      "Tags": [
        "@k-cra",
        "@probes/kubernetes/container_registry_access",
        "@k-cra-003"
      ],
      "Steps": {
        "1": {
          "Name": "aKubernetesClusterIsDeployed",
          "Description": "Validated that the k8s cluster specified in '/root/.kube/config' is deployed by checking the '' context; ",
          "Result": "Passed",
          "Error": "",
          "Payload": {
            "KubeConfigPath": "/root/.kube/config",
            "KubeContext": ""
          }
        },
        "2": {
          "Name": "aUserAttemptsToDeployUnauthorisedContainer",
          "Description": "Attempts to deploy a container from docker.io. Retains pod creation result in scenario state; ",
          "Result": "Passed",
          "Error": "",
          "Payload": {
            "UnauthorizedRegistry": "docker.io",
            "PodAudit": {
              "PodName": "ca-test-docker-io-220221-103717-99",
              "Namespace": "probr-general-test-ns",
              "ContainerName": "container-access-test",
              "Image": "docker.io/citihub/probr-probe",
              "SecurityContext": null
            }
          }
        },
        "3": {
          "Name": "theDeploymentAttemptIsDenied",
          "Description": "Asserts pod creation result in scenario state is denied; ",
          "Result": "Passed",
          "Error": "",
          "Payload": {
            "PodState": {
              "PodName": "",
              "CreationError": {
                "ReasonCodes": {
                  "4": 9
                }
              },
              "ExpectedReason": 4,
              "CommandExitCode": 0
            }
          }
        }
      }
    }
  }
}